<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Portfolio</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 80%;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            text-align: center;
        }
        input, select, button {
            width: calc(100% - 40px);
            padding: 10px;
            margin: 10px 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #333;
            color: #fff;
            cursor: pointer;
        }
        button:hover {
            background-color: #555;
        }
        .result {
            margin: 20px 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Generate Investment Portfolio</h1>
        <h2>Create Portfolio</h2>
        <select id="riskLevel">
            <option value="low">Low Risk</option>
            <option value="medium">Medium Risk</option>
            <option value="high">High Risk</option>
        </select>
        <input type="number" id="investmentValue" placeholder="Investment Value">
        <button onclick="createPortfolio()">Create Portfolio</button>
        <div id="result" class="result"></div>
    </div>

    <script>
        const FINNHUB_API_KEY = 'cqhq1u1r01qgbqu5tirgcqhq1u1r01qgbqu5tis0';
        const STOCKDATA_API_KEY = 'n7enZckAhvpoPHb1GWYR3em5J3Gp1I2OjJVwKsc6';

        const fetchStockData = async (symbol) => {
            try {
                const response = await fetch(`https://finnhub.io/api/v1/stock/profile2?symbol=${symbol}&token=${FINNHUB_API_KEY}`);
                return response.json();
            } catch (error) {
                console.error(`Error fetching stock data for ${symbol}:`, error);
                throw error;
            }
        };

        const fetchStockPrice = async (symbol) => {
            try {
                const response = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${FINNHUB_API_KEY}`);
                const data = await response.json();
                return data.c; // c is the current price
            } catch (error) {
                console.error(`Error fetching stock price for ${symbol}:`, error);
                throw error;
            }
        };

        const fetchHistoricalPrice = async (symbol, from, to) => {
            try {
                const response = await fetch(`https://api.stockdata.org/v1/data/eod?symbols=${symbol}&api_token=${STOCKDATA_API_KEY}&date_from=${from}&date_to=${to}`);
                const data = await response.json();
                return data.data;
            } catch (error) {
                console.error(`Error fetching historical prices for ${symbol}:`, error);
                throw error;
            }
        };

        const fetchExpectedReturn = async (symbol) => {
            const now = new Date().toISOString().split('T')[0];
            const oneYearAgo = new Date(new Date().setFullYear(new Date().getFullYear() - 1)).toISOString().split('T')[0];

            try {
                const historicalData = await fetchHistoricalPrice(symbol, oneYearAgo, now);

                if (!historicalData || historicalData.length === 0) {
                    throw new Error('Historical data is missing or incomplete');
                }

                const firstClosePrice = historicalData[0].close;
                const lastClosePrice = historicalData[historicalData.length - 1].close;

                const expectedReturn = ((lastClosePrice - firstClosePrice) / firstClosePrice) * 100;

                return expectedReturn;
            } catch (error) {
                console.error(`Error fetching expected return for ${symbol}:`, error);
                throw error;
            }
        };

        const createPortfolio = async () => {
            const riskLevel = document.getElementById('riskLevel').value;
            const investmentValue = parseFloat(document.getElementById('investmentValue').value);
            const resultDiv = document.getElementById('result');

            if (isNaN(investmentValue) || investmentValue <= 0) {
                resultDiv.innerHTML = '<p class="error">Please enter a valid investment value.</p>';
                return;
            }

            const symbols = riskLevel === 'low'
                ? ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'META', 'PEP', 'INTC', 'CSCO', 'NVDA', 'TXN']
                : riskLevel === 'medium'
                ? ['PYPL', 'ADBE', 'NFLX', 'AMD', 'QCOM', 'TSLA', 'ZM', 'CRWD', 'ADSK', 'SNPS']
                : ['MRNA', 'ROKU', 'DOCU', 'OKTA', 'DDOG', 'TEAM', 'PLTR', 'ZS', 'TWLO', 'SNAP'];

            const ratios = riskLevel === 'low'
                ? [0.15, 0.15, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.05, 0.05]
                : riskLevel === 'medium'
                ? [0.12, 0.12, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.08, 0.08]
                : [0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10];

            resultDiv.innerHTML = 'Loading...';

            try {
                const portfolio = await Promise.all(symbols.map(async (symbol, index) => {
                    const [data, price, expectedReturn] = await Promise.all([
                        fetchStockData(symbol),
                        fetchStockPrice(symbol),
                        fetchExpectedReturn(symbol)
                    ]);

                    return {
                        symbol: data.ticker,
                        name: data.name,
                        value: investmentValue * ratios[index],
                        price: price,
                        expectedReturn: expectedReturn
                    };
                }));

                resultDiv.innerHTML = `
                    <h2>Generated Portfolio</h2>
                    <ul>
                        ${portfolio.map(stock => `
                            <li>
                                <strong>${stock.symbol} - ${stock.name}</strong>: $${stock.value.toFixed(2)} at $${stock.price}, Expected Return: ${stock.expectedReturn.toFixed(2)}%
                            </li>
                        `).join('')}
                    </ul>
                `;
            } catch (error) {
                resultDiv.innerHTML = '<p class="error">Failed to create portfolio. Please try again.</p>';
                console.error('Error in createPortfolio:', error);
            }
        };
    </script>
</body>
</html>
